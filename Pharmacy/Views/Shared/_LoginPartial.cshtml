@using Microsoft.AspNetCore.Identity
@using Pharmacy.Models
@inject SignInManager<Users> SignInManager
@inject UserManager<Users> UserManager
<ul class="navbar-nav ms-auto align-items-center">

    @if (SignInManager.IsSignedIn(User))
    {
        var user = await UserManager.GetUserAsync(User);
        var displayName = string.IsNullOrWhiteSpace(user?.FullName) ? user?.UserName ?? User.Identity.Name : user.FullName;
        var email = user?.Email ?? User.Identity.Name;
        
        // Use user's profile picture if available, otherwise use default
        var avatarUrl = !string.IsNullOrEmpty(user?.ProfilePicture) 
            ? Url.Content($"~/Images/{user.ProfilePicture}") 
            : Url.Content("~/Images/download (2).png");

        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="@avatarUrl" alt="avatar" class="rounded-circle me-2" style="width:32px;height:32px;object-fit:cover;" />
                <span class="d-none d-md-inline">@displayName</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown" style="min-width:220px;">
                <li class="px-3 py-2">
                    <div class="d-flex align-items-center">
                        <img src="@avatarUrl" alt="avatar" class="rounded-circle me-2" style="width:40px;height:40px;object-fit:cover;" />
                        <div>
                            <div class="fw-bold">@displayName</div>
                            <div class="text-muted small">@email</div>
                        </div>
                    </div>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li class="px-3 py-2">
                    <form asp-controller="Account" asp-action="Logout" method="post" class="m-0">
                        @Html.AntiForgeryToken()
                        <button id="logout" type="submit" class="btn btn-link text-danger p-0">Logout</button>
                    </form>
                </li>
            </ul>
        </li>
    }
    else
    {
        <li class="nav-item">
            <a class="nav-link text-dark" asp-controller="Account" asp-action="Login">
                Login
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link text-dark" asp-controller="Account" asp-action="Register">
                Register
            </a>
        </li>
    }
</ul>
